# r.sim.water

**Category**: raster

## Description

Overland flow hydrologic simulation using path sampling method (SIMWE).

---

## grass.tools API (Recommended for new code)

⚠️ **Status**: Experimental in GRASS 8.5, will be stable in 8.6

### Function Signature

```python
tools.r_sim_water(elevation,dx,dy,rain=None,rain_value=50,infil=None,infil_value=0.0,man=None,man_value=0.1,flow_control=None,observation=None,depth=None,discharge=None,error=None,walkers_output=None,logfile=None,nwalkers=None,niterations=10,mintimestep=0.0,output_step=2,diffusion_coeff=0.8,hmax=0.3,halpha=4.0,hbeta=0.5,random_seed=None,nprocs=1,flags=None,overwrite=None,verbose=None,quiet=None,superquiet=None)
```

### Parameters

1. **`elevation : str | np.ndarray, required`**
   - Name of input elevation raster map
   - Used as: input, raster, name

2. **`dx : str | np.ndarray, required`**
   - Name of x-derivatives raster map [m/m]
   - Used as: input, raster, name

3. **`dy : str | np.ndarray, required`**
   - Name of y-derivatives raster map [m/m]
   - Used as: input, raster, name

4. **`rain : str | np.ndarray, optional`**
   - Name of rainfall excess rate (rain-infilt) raster map [mm/hr]
   - Used as: input, raster, name

5. **`rain_value : float, optional`**
   - Rainfall excess rate unique value [mm/hr]
   - Default: 50

6. **`infil : str | np.ndarray, optional`**
   - Name of runoff infiltration rate raster map [mm/hr]
   - Used as: input, raster, name

7. **`infil_value : float, optional`**
   - Runoff infiltration rate unique value [mm/hr]
   - Default: 0.0

8. **`man : str | np.ndarray, optional`**
   - Name of Manning's n raster map
   - Used as: input, raster, name

9. **`man_value : float, optional`**
   - Manning's n unique value
   - Default: 0.1

10. **`flow_control : str | np.ndarray, optional`**
   - Name of flow controls raster map (permeability ratio 0-1)
   - Used as: input, raster, name

11. **`observation : str, optional`**
   - Name of sampling locations vector points map
   - Or data source for direct OGR access
   - Used as: input, vector, name

12. **`depth : str | type(np.ndarray) | type(np.array) | type(gs.array.array), optional`**
   - Name for output water depth raster map [m]
   - Used as: output, raster, name

13. **`discharge : str | type(np.ndarray) | type(np.array) | type(gs.array.array), optional`**
   - Name for output water discharge raster map [m3/s]
   - Used as: output, raster, name

14. **`error : str | type(np.ndarray) | type(np.array) | type(gs.array.array), optional`**
   - Name for output simulation error raster map [m]
   - Used as: output, raster, name

15. **`walkers_output : str, optional`**
   - Base name of the output walkers vector points map
   - Name for output vector map
   - Used as: output, vector, name

16. **`logfile : str, optional`**
   - Name for sampling points output text file. For each observation vector point the time series of water discharge is stored.
   - Used as: output, file, name

17. **`nwalkers : int, optional`**
   - Number of walkers, default is twice the number of cells

18. **`niterations : int, optional`**
   - Time used for iterations [minutes]
   - Default: 10

19. **`mintimestep : float, optional`**
   - Minimum time step for the simulation [seconds]
   - A larger minimum time step substantially reduces processing time, but at the cost of accuracy
   - Default: 0.0

20. **`output_step : int, optional`**
   - Time interval for creating output maps [minutes]
   - Default: 2

21. **`diffusion_coeff : float, optional`**
   - Water diffusion constant
   - Default: 0.8

22. **`hmax : float, optional`**
   - Threshold water depth [m]
   - Diffusion increases after this water depth is reached
   - Default: 0.3

23. **`halpha : float, optional`**
   - Diffusion increase constant
   - Default: 4.0

24. **`hbeta : float, optional`**
   - Weighting factor for water flow velocity vector
   - Default: 0.5

25. **`random_seed : int, optional`**
   - Seed for random number generator
   - The same seed can be used to obtain same results or random seed can be generated by other means.

26. **`nprocs : int, optional`**
   - Number of threads which will be used for parallel computation.
   - Default: 1

27. **`flags : str, optional`**
   - Allowed values: t, s
   - t
   - Time-series output
   - *(see [full docs](https://grass.osgeo.org/grass-devel/manuals/r.sim.water.html#__tabbed_2_3) for all details)*

28. **`overwrite : bool, optional`**
   - Allow output files to overwrite existing files
   - Default: None

29. **`verbose : bool, optional`**
   - Verbose module output
   - Default: None

30. **`quiet : bool, optional`**
   - Quiet module output
   - Default: None

31. **`superquiet : bool, optional`**
   - Very quiet module output
   - Default: None


*Showing 10 of 31 parameters - see [full documentation](https://grass.osgeo.org/grass-devel/manuals/r.sim.water.html#__tabbed_2_3) for all*

### Returns

result : grass.tools.support.ToolResult | np.ndarray | tuple[np.ndarray] | None
If the tool produces text as standard output, a ToolResult object will be returned. Otherwise, None will be returned. If an array type (e.g., np.ndarray) is used for one of the raster outputs, the result will be an array and will have the shape corresponding to the computational region. If an array type is used for more than one raster output, the result will be a tuple of arrays.

### Raises

grass.tools.ToolError: When the tool ended with an error.

---

---

## Detailed Description

r.sim.water is a landscape scale simulation model of overland flow
designed for spatially variable terrain, soil, cover and rainfall excess
conditions. A 2D shallow water flow is described by the bivariate form
of Saint Venant equations. The numerical solution is based on the
concept of duality between the field and particle representation of the
modeled quantity. Green's function Monte Carlo method, used to solve the
equation, provides robustness necessary for spatially variable
conditions and high resolutions (Mitas and Mitasova 1998). The key
inputs of the model include elevation ( elevation raster map), flow
gradient vector given by first-order partial derivatives of elevation
field ( dx and dy raster maps), rainfall excess rate ( rain raster map or rain_value single value) and a surface roughness
coefficient given by Manning's n ( man raster map or man_value single value). Partial derivatives raster maps can be computed along
with interpolation of a DEM using the -d option in v.surf.rst module. If elevation raster map is already
provided, partial derivatives can be computed using r.slope.aspect module. Partial derivatives are
used to determine the direction and magnitude of water flow velocity. To
include a predefined direction of flow, map algebra can be used to
replace terrain-derived partial derivatives with pre-defined partial
derivatives in selected grid cells such as man-made channels, ditches or
culverts. Equations (2) and (3) from this
report can be used to compute partial derivates of the predefined flow using
its direction given by aspect and slope.

The equations are

and

Figure: Simulated water flow in a rural area showing the areas with
highest water depth highlighting streams, pooling, and wet areas during
a rainfall event.

The module automatically converts horizontal distances from feet to
metric system using database/projection information. Rainfall excess is
defined as rainfall intensity - infiltration rate and should be provided
in [mm/hr]. Rainfall intensities are usually available from
meteorological stations. Infiltration rate depends on soil properties
and land cover. It varies in space and time. For saturated soil and
steady-state water flow it can be estimated using saturated hydraulic
conductivity rates based on field measurements or using reference values
which can be found in literature. Optionally, user can provide an
overland flow infiltration rate map infil or a single value infil_value in [mm/hr] that control the rate of infiltration for
the already flowing water, effectively reducing the flow depth and
discharge. Overland flow can be further controlled by permeable check
dams or similar type of structures, the user can provide a map of these
structures and their permeability ratio in the map flow_control that
defines the probability of particles to pass through the structure (the
values will be 0-1).

Output includes a water depth raster map depth in [m], and a water
discharge raster map discharge in [m3/s]. Error of the numerical
solution can be analyzed using the error raster map (the resulting
water depth is an average, and err is its RMSE). The output vector
points map output_walkers can be used to analyze and visualize
spatial distribution of walkers at different simulation times (note that
the resulting water depth is based on the density of these walkers). The
spatial distribution of numerical error associated with path sampling
solution can be analysed using the output error raster file [m]. This
error is a function of the number of particles used in the simulation
and can be reduced by increasing the number of walkers given by
parameter nwalkers . Duration of simulation is controlled by the niterations parameter. The default value is 10 minutes, reaching the
steady-state may require much longer time, depending on the time step,
complexity of terrain, land cover and size of the area. Output walker,
water depth and discharge maps can be saved during simulation using the
time series flag -t and output_step parameter defining the time
step in minutes for writing output files. Files are saved with a suffix
representing time since the start of simulation in minutes (e.g.
wdepth.05, wdepth.10). Monitoring of water depth at specific points is
supported. A vector map with observation points and a path to a logfile
must be provided. For each point in the vector map which is located in
the computational region the water depth is logged each time step in the
logfile. The logfile is organized as a table. A single header identifies
the category number of the logged vector points. In case of invalid
water depth data the value -1 is used.

Overland flow is routed based on partial derivatives of elevation field
or other landscape features influencing water flow. Simulation equations
include a diffusion term ( diffusion_coeff parameter) which enables
water flow to overcome elevation depressions or obstacles when water
depth exceeds a threshold water depth value ( hmax) , given in [m].
When it is reached, diffusion term increases as given by halpha and
advection term (direction of flow) is given as "prevailing" direction of
flow computed as average of flow directions from the previous hbeta number of grid cells. The model tries to keep water "shallow" with
maximum shallow water depth defined by hmax default 0.3 meters.
However, water depths much higher than hmax can be observed if water
accumulates in natural sinks or river beds. Depending on the area of
interest and the used digital elevation model, hmax , halpha and hbeta might need to be adjusted in order to deal realistically with
elevation depressions or obstacles.

---

## See Also

Related tools:
- [`v.surf.rst`](https://grass.osgeo.org/grass-devel/manuals/v.surf.rst.html)
- [`r.slope.aspect`](https://grass.osgeo.org/grass-devel/manuals/r.slope.aspect.html)
- [`r.sim.sediment`](https://grass.osgeo.org/grass-devel/manuals/r.sim.sediment.html)

---

## Authors

Helena Mitasova, Lubos Mitas North Carolina State University hmitaso@unity.ncsu.edu
Jaroslav Hofierka GeoModel, s.r.o. Bratislava, Slovakia hofierka@geomodel.sk
Chris Thaxton North Carolina State University csthaxto@unity.ncsu.edu

---

## Resources

- [Official r.sim.water manual](https://grass.osgeo.org/grass-devel/manuals/r.sim.water.html)
- [grass.tools API documentation](https://grass.osgeo.org/grass-devel/manuals/r.sim.water.html#__tabbed_1_3)
- [GRASS GIS Documentation](https://grass.osgeo.org/grass85/manuals/)

---

*Generated from GRASS GIS 8.5 documentation*
